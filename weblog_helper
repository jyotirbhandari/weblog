#!/bin/bash

var=0

while getopts "i:(ip)-h(help)-:" opt
do
    case $opt in
        h ) echo -e "Usage: weblog_helper [option] <ADDRESS>\n"; 
            echo -e "Options:\n\n\t"
            echo -e "\t-i --ip\t\tIP ADDRESS or CIDR ADDRESS\n";
            echo -e "\t-h --help\tusage help\n";
            shift;;
        i ) var=$2; shift;; 
    esac
done

regex_ip4='^([0-9]{1,3}\.){3}[0-9]{1,3}(\/([0-9]|[1-2][0-9]|3[0-2]))?$'
file=./source.txt

ipcalc_network=`ipcalc $var |grep 'Network' |awk '{print $2}'`
while read line
do
    if [[ "$var" =~ $regex_ip4 ]] && network=$ipcalc_network;then
        ip=`echo $line |awk '{print $1}'`
        var=`/usr/local/bin/ipcalc "$ip" |grep 'Network' |awk '{print $2}'`
        if [[ $network == $var ]];then
            echo "$line" | grep "$ip"
        fi
     else
         exit 0
    fi
done < "$file"


